# ボードゲーム「POLYFORM」Web版 仕様書

## 1. ゲーム概要

**コンセプト**: パズルピースを集めて配置し、パズルカードを完成させる拡大再生産パズルゲーム

| 項目 | 内容 |
|------|------|
| プレイ人数 | 2〜4人 |
| プレイ時間 | 30〜60分 |
| 対象年齢 | 10歳〜 |

---

## 2. コンポーネント

### 2.1 ピース（9種類）

ピースはレベル1〜4の4段階に分かれ、レベルが高いほどマス数が多い。

| レベル | タイプ | 名称 | マス数 | 色 |
|--------|--------|------|--------|-----|
| 1 | dot | 1マス | 1 | 黄色 |
| 2 | i2 | I字(2) | 2 | 緑 |
| 3 | i3 | I字(3) | 3 | 青 |
| 3 | v3 | V字 | 3 | オレンジ |
| 4 | i4 | I字(4) | 4 | 紫 |
| 4 | l4 | L字(4) | 4 | 水色 |
| 4 | t4 | T字 | 4 | ピンク |
| 4 | s4 | S字 | 4 | オレンジ |
| 4 | o4 | 正方形 | 4 | 赤 |

#### ピースの初期ストック数

| タイプ | 枚数 |
|--------|------|
| dot | 15枚 |
| i2 | 12枚 |
| i3, v3 | 各6枚 |
| i4, l4, t4, s4, o4 | 各6枚 |

### 2.2 パズルカード

パズルカードは白と黒の2種類があり、それぞれ32枚ずつ（計64枚）。

| 種類 | 特徴 |
|------|------|
| 白カード | 比較的シンプルな形状、低〜中ポイント |
| 黒カード | 複雑な形状、高ポイント |

各カードには以下の要素がある：
- **ポイント**: 完成時に獲得できる得点（0〜10pt程度）
- **報酬ピース**: 完成時に獲得できるピース（ないカードもある）
- **形状**: 5x5グリッド内で埋めるべきマスのパターン

---

## 3. ゲームルール

### 3.1 セットアップ

1. 白・黒パズルデッキをそれぞれシャッフル
2. 場に白パズル4枚、黒パズル4枚を公開
3. 各プレイヤーに初期ピース（dot x 2）を配布
4. スタートプレイヤーを決定

### 3.2 ターン進行

各プレイヤーは自分のターンに **3アクション** を実行できる。

#### アクション一覧

| アクション | 説明 | 消費 |
|------------|------|------|
| パズル取得 | 場または山札からパズルカードを1枚獲得（最大4枚まで所持可能） | 1アクション |
| ピース獲得 | レベル1ピース（dot）を1個獲得 | 1アクション |
| ピース配置 | 手持ちピースを作業中パズルに配置 | 1アクション |
| レベル変更 | ピースをレベルアップまたはレベルダウン | 1アクション |
| リサイクル | 場のカード4枚を山札に戻し、新しい4枚を公開 | 1アクション |
| マスターアクション | 全ての作業中パズルに1個ずつピース配置可能（1ターン1回のみ） | 1アクション |

### 3.3 ピースの操作

#### 回転・反転
- ピースは90度単位で回転可能（0°, 90°, 180°, 270°）
- 左右反転も可能

#### レベル変更
- **レベルアップ**: 小さいピースを大きいピースに交換
- **レベルダウン**: 大きいピースを小さいピースに分解
- レベル3以上は複数の形状から選択可能

### 3.4 パズル完成

パズルカードのすべてのマスをピースで埋めると完成となる。

完成時：
1. カードに記載されたポイントを獲得
2. 報酬ピースがあれば獲得
3. パズルカードは完成エリアへ移動（作業中スロットが空く）

### 3.5 ゲーム終了条件

以下のいずれかで最終ラウンドに突入：
- いずれかのプレイヤーが白カードを5枚完成
- いずれかのプレイヤーが黒カードを3枚完成
- 白または黒の山札が尽きた

最終ラウンドでは、トリガーを引いたプレイヤーの手前まで全員がプレイして終了。

### 3.6 勝利条件

最終得点が最も高いプレイヤーの勝利。

---

## 4. 実装済み機能

### 4.1 画面構成

#### ① ロビー画面

- ルーム作成（4桁のルームコード生成）
- ルーム参加（コード入力）
- プレイヤー一覧表示
- ゲーム設定（スコア公開/非公開）
- ゲーム開始ボタン（ホストのみ、2人以上で有効）

#### ② ゲーム画面

| エリア | 説明 |
|--------|------|
| ヘッダー | ロゴ、プレイヤー名、スコア、ターン表示、各種ボタン |
| プレイヤー欄 | 全プレイヤーの状態（所持パズル、完成枚数、ピース） |
| インフォボード | ターン情報、アクション選択、アナウンス表示 |
| 場 | 白パズル4枚＋山札、黒パズル4枚＋山札 |
| ピース一覧 | 全ピース種類のリファレンス表示 |
| 手持ちパズル | 作業中パズル（最大4枚）とピース配置UI |
| 手持ちピース | 所持ピース一覧、選択・操作UI |

#### ③ インタラクション

- **ドラッグ＆ドロップ**: ピースをパズルへ配置
- **回転・反転ボタン**: 選択中ピースを変形
- **UP/DOWNボタン**: レベル変更
- **ホバープレビュー**: 配置可能位置のハイライト表示

### 4.2 UI/UX機能

- レスポンシブデザイン（7段階のカードサイズ対応）
- 1280px以下でレイアウト自動切り替え（縦積み）
- アクションモード別のハイライト表示
- カード取得・リサイクルアニメーション
- パズル完成アニメーション
- アナウンス表示（自動消去）

### 4.3 通信・同期

| 機能 | 実装方式 |
|------|------|
| リアルタイム同期 | Firebase Realtime Database |
| ルーム管理 | 4桁コード方式 |
| ホスト権限継承 | プレゼンスシステムで自動継承 |
| 自動削除 | 全員切断時にルーム削除 |

---

## 5. ディレクトリ構成

```
src/games/polyform-dev/
├── PolyformDevGame.tsx       # メインコンポーネント
├── components/
│   ├── Lobby.tsx             # ロビー画面
│   ├── GamePlayPhase.tsx     # ゲーム画面
│   ├── PuzzleCardDisplay.tsx # パズルカード表示
│   ├── DroppablePuzzleCard.tsx # ドロップ可能パズルカード
│   ├── PieceDisplay.tsx      # ピース表示
│   └── DraggablePiece.tsx    # ドラッグ可能ピース
├── hooks/
│   └── useRoom.ts            # ルーム管理フック
├── data/
│   ├── pieces.ts             # ピース定義
│   └── puzzles.ts            # パズルカード定義
└── types/
    └── game.ts               # 型定義
```

---

## 6. ゲーム設定

### 6.1 実装済みオプション

| 機能 | 説明 |
|------|------|
| スコア表示 | 公開（常時表示）/ 非公開（終了時まで非表示） |

### 6.2 未実装オプション

| 機能 | 説明 |
|------|------|
| ゲーム終了条件変更 | 完成枚数の調整 |
| 初期ピース変更 | 開始時のピース構成を変更 |

---

## 7. 開発版（polyform-dev）

開発版では以下の追加機能が利用可能：

- デバッグモード: 任意のプレイヤーを操作可能（プルダウンで切り替え）
- テストプレイヤー追加: 1人でもテストプレイ可能
- 1人でもゲーム開始可能
- 即終了ボタン: ゲームを即座に終了状態にする
- 全ピース追加: デバッグ用に任意のピースを追加可能

---

## 8. レスポンシブ対応

### ブレークポイント

| 画面幅 | カードサイズ | レイアウト |
|--------|-------------|----------|
| 1850px〜 | xxl | 2カラム |
| 1650px〜 | xl | 2カラム |
| 1500px〜 | lg | 2カラム |
| 1300px〜 | md | 2カラム |
| 1100px〜 | sm | 2カラム |
| 900px〜 | xs | 2カラム |
| 〜900px | xxs | 2カラム |
| 〜1280px | - | 1カラム（縦積み）、ピース一覧非表示 |

---

## 9. 今後の拡張案

- ゲーム終了画面の実装
- 観戦モード
- AI対戦
- 戦績記録
- チュートリアルモード
- 本番版（polyform）の実装
