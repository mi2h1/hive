# ボードゲーム「ジャッカル」Web版 仕様書

## 1. ゲーム概要

**コンセプト**: 自分のカードだけ見えない状態で、場の合計値を推理するブラフ＆心理戦ゲーム

| 項目 | 内容 |
|------|------|
| プレイ人数 | 2〜10人 |
| プレイ時間 | 15〜30分 |
| 対象年齢 | 10歳〜 |

---

## 2. カード構成（全36枚）

### 2.1 数字カード（32枚）

| 数値 | 枚数 |
|------|------|
| -10 | 1枚 |
| -5 | 2枚 |
| 0 | 3枚 |
| 0（シャッフル） | 1枚（特殊カード） |
| 1 | 4枚 |
| 2 | 4枚 |
| 3 | 4枚 |
| 4 | 4枚 |
| 5 | 4枚 |
| 10 | 3枚 |
| 15 | 2枚 |
| 20 | 1枚 |

### 2.2 特殊カード（4枚）

| カード | 効果 |
|--------|------|
| 0（シャッフル） | ラウンド終了時、捨て札を山札に混ぜてシャッフルする |
| ×2 | 場の合計値を最後に2倍にする |
| MAX→0 | 場の最大数字を0に変える |
| ? | ジャッカル宣言時に山札から1枚引いてその数字に置き換わる |

### 2.3 特殊カードの処理順序

1. 「?」カードがある場合 → 山札から1枚引いて置き換え
2. 「MAX→0」カードがある場合 → 最大値を0に変更（?で引いたカードも対象）
3. 特殊カード以外の数字を合計
4. 「×2」カードがある場合 → 合計値を2倍

---

## 3. ゲームルール

### 3.1 セットアップ

1. 各プレイヤーにライフを付与（設定により2または3）
2. 山札をシャッフル
3. 各プレイヤーに1枚ずつカードを配布
4. **カードは自分に見えないように保持**（Web版では自分のカードのみ裏面表示）

### 3.2 ラウンド進行

```
┌─────────────────────────────────────┐
│           ラウンド開始               │
│  各プレイヤーに1枚カード配布         │
└───────────────┬─────────────────────┘
                ↓
┌─────────────────────────────────────┐
│      スタートプレイヤーが数字宣言    │
│  （最初のプレイヤーは必ず宣言）      │
└───────────────┬─────────────────────┘
                ↓
┌─────────────────────────────────────┐
│        次のプレイヤーの選択          │
│  A: より大きい数字を宣言             │
│  B: 「ジャッカル！」と宣言           │
└───────────────┬─────────────────────┘
                ↓
    ┌───────────┴───────────┐
    ↓                       ↓
┌─────────┐           ┌─────────────┐
│ Aを選択 │           │  Bを選択    │
│次の人へ │           │  判定処理   │
└────┬────┘           └──────┬──────┘
     │                       ↓
     │              ┌─────────────────┐
     │              │  全カード公開   │
     │              │  合計値を計算   │
     │              └────────┬────────┘
     │                       ↓
     │         ┌─────────────┴─────────────┐
     │         ↓                           ↓
     │  ┌─────────────────┐     ┌─────────────────┐
     │  │ 宣言 > 合計値   │     │ 宣言 ≦ 合計値  │
     │  │ → ジャッカル成功│     │ → ジャッカル失敗│
     │  │ → 宣言者の負け │     │ → ジャッカル   │
     │  └────────┬────────┘     │    宣言者の負け │
     │           │              └────────┬────────┘
     │           └──────────┬───────────┘
     │                      ↓
     └──────────────→ ┌─────────────────┐
                       │ 負けた人がライフ-1│
                       │ カード再配布      │
                       │ 次ラウンド開始    │
                       └─────────────────┘
```

### 3.3 ジャッカル判定

「ジャッカル！」が宣言されたら：

1. 全員のカードを公開
2. 合計値を計算（特殊カードの効果を適用）
3. 判定：
   - **直前の宣言 > 合計値** → ジャッカル成功（宣言した人の負け）
   - **直前の宣言 ≦ 合計値** → ジャッカル失敗（ジャッカルを宣言した人の負け）

### 3.4 勝敗条件

- ライフが0になったプレイヤーは脱落
- 最後まで生き残ったプレイヤーが勝利
- 脱落したプレイヤーは次ラウンド以降ゲームに参加しない

---

## 4. 実装済み機能

### 4.1 画面構成

#### ① ロビー画面

- ルーム作成（4桁のルームコード生成）
- ルーム参加（コード入力）
- プレイヤー一覧表示
- ゲーム設定（初期ライフ: 2 or 3）
- ゲーム開始ボタン（ホストのみ、2人以上で有効）

#### ② ゲーム画面

| 要素 | 説明 |
|------|------|
| プレイヤー配置 | 多角形配置（中央に宣言値表示） |
| 自分のカード | 裏面表示（見えない） |
| 他プレイヤーのカード | 表面表示 |
| 現在の宣言値 | 中央に大きく表示（変化時に鼓動アニメーション） |
| ライフ表示 | 各プレイヤーの残りライフ（♡で表示） |
| 宣言入力 | 数字入力（+/-ボタンあり、最小値自動入力） |
| 行動ボタン | 「宣言」「ジャッカル！」（ジャッカルは2手目以降のみ表示） |
| ターン表示 | 現在のプレイヤー名 |
| 脱落者表示 | 右下にグレーアウトで小さく表示 |

**レスポンシブ対応:**
- PC (lg以上): 左カラム（多角形配置）＋ 右カラム（宣言パネル＋カード一覧）
- タブレット (md〜lg): 上部（多角形配置）＋ 下部（宣言パネル）
- スマホ (md未満): 多角形配置 ＋ 下部固定入力パネル

**カードサイズ:**
- スマホ: md (64px)
- タブレット: lg (80px)
- PC: xl (112px)

#### ③ 判定画面（アニメーション付き）

**演出フロー:**

1. **ジャッカルコールオーバーレイ**: スターバースト枠 + ジャッカルロゴ（フェード＋拡大、斜め配置）
2. **ハテナカード演出**（?カードがある場合のみ）: カード裏面→表面へ3Dフリップ、引いたカードを表示
3. **「〇〇 が ジャッカル！」表示**: フェードイン
4. **宣言された数字表示**: 1秒後にフェードイン
5. **場の合計表示**: 2秒後にフェードイン
6. **判定結果**: 3秒後（ジャッカル成功/失敗）、宣言数字ボックスがハイライト
7. **カード公開**: 4秒後（敗者にダメージアニメーション）
8. **アクションボタン**: 5秒後
   - ホスト: 「次のラウンドへ」ボタン
   - 非ホスト: 「ホストの操作を待っています...」表示
   - ゲーム終了時: タップで結果画面へ自動遷移

#### ④ ゲーム終了画面

- 勝者表示（トロフィーアイコン）
- 最終順位（脱落順でソート）
- ホスト: 「退出」「もう一度プレイ」ボタン
- 非ホスト: 「ホストの選択を待っています...」表示

### 4.2 UI/UX機能

- カード画像表示（正方形1:1、レスポンシブサイズ対応）
- 多角形配置（プレイヤー数に応じて自動計算、2人は横並び、3人以上は正多角形）
- ライフ表示（塗りつぶし♡ = 残りライフ、中抜き♡ = 失ったライフ）
- 宣言値変化時の鼓動アニメーション（スケール拡縮）
- ジャッカルコール時のスターバースト演出（SVGパス生成による吹き出し風フレーム）
- ハテナカードフリップ演出（3D回転アニメーション、0.8秒）
- ダメージアニメーション（震え + ハート消失演出）
- 段階的フェードインアニメーション（判定画面）
- タップで結果画面へ即座に遷移（ゲーム終了時）
- 自分のターン時に最小宣言値を自動入力
- ジャッカルボタンは2手目以降のみ表示（1手目は非表示）
- 次ラウンドボタンはホスト専用（ゲストは待機メッセージ表示）

### 4.3 通信・同期

| 機能 | 実装方式 |
|------|------|
| リアルタイム同期 | Firebase Realtime Database |
| ルーム管理 | 4桁コード方式 |
| ホスト権限継承 | プレゼンスシステムで自動継承 |
| 自動削除 | 全員切断時にルーム削除 |

---

## 5. ディレクトリ構成

```
src/games/jackal/
├── JackalGame.tsx              # メインコンポーネント
├── components/
│   ├── Lobby.tsx               # ロビー画面
│   ├── GamePlayPhase.tsx       # ゲーム画面
│   ├── JudgmentPhase.tsx       # 判定結果画面
│   ├── GameEndPhase.tsx        # ゲーム終了画面
│   ├── Card.tsx                # カード表示コンポーネント
│   ├── CardReference.tsx       # カード一覧（PC用サイドバー）
│   ├── PlayerCardsPolygon.tsx  # 多角形配置プレイヤーカード
│   ├── DeclaredValueDisplay.tsx # 中央宣言値表示
│   ├── DeclarationPanel.tsx    # 宣言入力パネル
│   ├── JackalCallOverlay.tsx   # ジャッカルコール演出
│   └── MysteryCardReveal.tsx   # ハテナカードフリップ演出
├── hooks/
│   └── useRoom.ts              # ルーム管理フック
├── lib/
│   ├── cards.ts                # カード生成・計算ロジック
│   └── layout.ts               # 多角形配置計算
└── types/
    └── game.ts                 # 型定義
```

---

## 6. ゲーム設定

### 6.1 実装済みオプション

| 機能 | 説明 |
|------|------|
| 初期ライフ設定 | 2または3で選択可能 |

### 6.2 未実装オプション

| 機能 | 説明 |
|------|------|
| スペシャルカード | 上級ルール用（未実装） |
| 制限時間設定 | ターン制限時間（未実装） |

---

## 7. 開発版（jackal-dev）

開発版では以下の追加機能が利用可能：

- デバッグモード: 任意のプレイヤーを操作可能
- テストプレイヤー追加: 1人でもテストプレイ可能
- 1人でもゲーム開始可能

---

## 8. 今後の拡張案

- スペシャルカード対応
- 観戦モード
- AI対戦
- 戦績記録
- リプレイ機能
