# アトランティスの深淵 - ゲーム仕様書

## 概要

「アトランティスの深淵」は、Board Game Arena の「インカの黄金」をベースに、より射幸心を煽るゲーム性に改変したオンラインマルチプレイヤーボードゲームです。

### 基本ルール
- プレイヤーは探検家として遺跡を探索
- 毎ターン「進む」か「帰る」を選択
- 進むとカードがめくられ、宝石なら山分け、罠なら危険
- 同じ罠が2枚出たら、残っているプレイヤー全員が獲得物を失う
- 帰ると、それまでに獲得した宝石を確定できる
- 5ラウンド行い、最も宝石を集めたプレイヤーが勝利

---

## カード構成

### デッキ構成
デッキ = 宝石カード(13枚) + 罠カード(15枚) + 特殊カード(4枚) = **合計32枚**

### 宝石カード（13枚）

| カテゴリ | 数値 | 枚数 |
|---------|------|------|
| 低額 | 1, 2, 3, 4, 5 | 各1枚（5枚） |
| 中額 | 7, 9, 11 | 各1枚（3枚） |
| 高額 | 15, 20, 25 | 各1枚（3枚） |
| 超高額 | 30, 50 | 各1枚（2枚） |

### 罠カード（15枚）
5種類 × 3枚
- 🕷️ クモ
- 🐍 ヘビ
- 🔥 火炎
- 💀 落石
- 🦂 サソリ

※ 同じ種類の罠が**2枚**出たら、残っているプレイヤー全員が未確定の宝石を失う

### 特殊カード（4枚）

| 効果 | 枚数 | 説明 |
|------|------|------|
| 💰 端数2倍 | 1枚 | 場に残っている端数宝石が2倍になる |
| 🎁 全員ボーナス | 1枚 | 残っている全員に+5 |
| ⚡ 3枚ドロー | 1枚 | 直後に3枚一気にめくる |
| 🛡️ 罠削除 | 1枚 | 場の一番古い罠をゲームから除外 |

---

## ミステリーカード

ミステリーカードは「別のカード種類」ではなく、通常のカードめくり時に発生する**特殊な出現方法**。

| 項目 | 内容 |
|------|------|
| 発生確率 | 約8% |
| 発生時の挙動 | デッキからめくったカードが裏向きのまま場に置かれる |
| 溜まる？ | 溜まる（複数枚が裏向きで並ぶことがある） |
| 公開タイミング | 誰かが「帰る」を選択した時 |
| 公開順序 | 古いものから順に解決 |

---

## ターンイベント

ターン開始時にランダムで発生する特別ルール。

### 基本仕様

| 項目 | 内容 |
|------|------|
| 発生確率 | 約10% |
| 発生数 | 1ターンにつき最大1つ |
| 種類 | 3種類からランダム |

### イベント一覧

| イベント | 効果 | 発生ラウンド |
|----------|------|-------------|
| 🔥 コンボチャンス | 連続で宝石が出るたびに+5ボーナス加算 | 全ラウンド |
| 👑 ラストサバイバー | このターン最後まで残った人に+20 | 全ラウンド |
| 🎰 オールインタイム | ターン開始時に「オールイン」宣言が可能 | **5ラウンド目のみ** |

### オールイン詳細
- **宣言タイミング**: ターン開始時に各プレイヤーが個別に選択
- **成功時**: このターンの獲得が2倍
- **失敗時（罠で脱落）**: 全ラウンド累計すべて没収（0点に戻る）

---

## 遺物カード

### 基本仕様

| 項目 | 内容 |
|------|------|
| 追加タイミング | ラウンド2, 3, 4, 5の開始時（計4回） |
| 価値決定 | 毎ラウンド開始時にルーレット演出で決定 |
| 獲得条件 | そのターン**1人だけで帰った人**が獲得 |
| 複数人帰還時 | 誰も獲得できず、場に残る |

### ルーレット確率

#### ラウンド 2, 3, 4

| 値 | 確率 |
|----|------|
| 20 | 40% |
| 25 | 30% |
| 30 | 20% |
| 50 | 10% |

#### ラウンド 5（最終）

| 値 | 確率 |
|----|------|
| 20 | 36% |
| 25 | 28% |
| 30 | 18% |
| 50 | 14% |
| 💎 100 | 4% |

---

## ゲームフロー

### ターンの流れ

1. **ターン開始**: イベント判定（10%で発生）
2. **決定フェーズ**: 各プレイヤーが「進む」or「帰る」を選択
   - 選択は他プレイヤーには非公開（「決定済」とのみ表示）
   - 全員が選択完了するまで待機
3. **公開フェーズ**: 全員の選択を2秒間表示
4. **帰還処理**:
   - 帰還プレイヤーは未確定宝石を確定
   - 1人だけ帰還した場合、端数宝石と遺物を獲得
5. **探索処理**:
   - 進むプレイヤーがいる場合、カードをめくる
   - カード効果を処理

### ラウンドの流れ

1. **ラウンド開始**: 遺物価値の決定（ラウンド2以降）
2. **ターン繰り返し**: 全員が帰還または脱落するまで
3. **ラウンド終了**: 次ラウンドへ（5ラウンドでゲーム終了）

---

## マルチプレイヤー仕様

### ルームシステム
- 4文字のルームコードで部屋を識別
- ホスト（部屋作成者）がゲーム進行を管理
- ゲスト（参加者）はルームコードで参加

### プレイヤー管理
- ニックネームはlocalStorageに保存
- 初回アクセス時にニックネーム入力を要求
- 最大6人まで参加可能

### リアルタイム同期
- Firebase Realtime Databaseで状態を同期
- 全員の決定が揃うと自動でターン進行

### ルームの自動削除
- 新規ルーム作成時に古いルームを自動クリーンアップ
- 削除対象:
  - 作成から24時間以上経過したルーム
  - プレイヤーが0人のルーム

---

## ビジュアル・演出

### カラーテーマ
- 海洋（深海）をイメージした配色
- メインカラー: シアン / ティール / スレート
- 背景: 深い青のグラデーション

### カード画像
- 宝石カード: 価値に応じて小・中・大の3種類
- 罠カード: 5種類それぞれ専用の画像
- 遺物カード: 9種類の中からランダムに決定
- カード裏面: 共通のデザイン

### 宝石分配アニメーション
宝石カードが場に出た時、探索中のプレイヤーへ宝石が飛んでいくアニメーション

| 条件 | 動作 |
|------|------|
| 宝石数 < プレイヤー数 | アニメーションなし（全て端数へ） |
| 宝石数 ≧ プレイヤー数 | プレイヤー数の宝石が各方向へ飛ぶ |

**ウェーブ回数**（1人あたりの分配数に応じて繰り返し）:
- 1-2個/人: 1ウェーブ
- 3-4個/人: 2ウェーブ
- 5-6個/人: 3ウェーブ
- 7-8個/人: 4ウェーブ
- 9個以上/人: 5ウェーブ

### 端数宝石の表示
- カード上部に宝石アイコンを整列表示
- 最大10個まで表示
- 白いドロップシャドウで視認性を確保

---

## 用語定義

### ゲーム進行

| 用語 | 定義 |
|------|------|
| **ゲーム** | 1回のプレイ全体（5ラウンドで構成） |
| **ラウンド** | ゲームを構成する大きな区切り（全5ラウンド） |
| **ターン** | ラウンド内の1サイクル（カードめくり→判断→処理） |

### カード関連

| 用語 | 定義 |
|------|------|
| **デッキ（山札）** | 場にまだ出ていないカードの山 |
| **場** | めくられたカードが置かれる場所 |
| **カード** | 宝石・罠・特殊の総称 |
| **ミステリー** | 裏向きで場に出ているカード（カード種類ではなく状態） |

### 宝石関連

| 用語 | 定義 |
|------|------|
| **未確定宝石** | 探索中に獲得したが、まだ確定していない宝石 |
| **確定宝石** | 帰還して確定した宝石（失われない） |
| **端数** | プレイヤー間で割り切れず、場に残っている宝石 |

### プレイヤー行動

| 用語 | 定義 |
|------|------|
| **進む（探索続行）** | そのターン、探索を続ける |
| **帰る（帰還）** | 未確定宝石を確定させて、そのラウンドを離脱 |
| **脱落** | 罠で強制的にラウンドを離脱（未確定宝石を失う） |
